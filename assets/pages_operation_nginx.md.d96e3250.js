import{_ as s,o as n,c as a,X as l}from"./chunks/framework.6e839c56.js";const E=JSON.parse('{"title":"Nginx","description":"","frontmatter":{},"headers":[],"relativePath":"pages/operation/nginx.md","filePath":"pages/operation/nginx.md","lastUpdated":1694348019000}'),p={name:"pages/operation/nginx.md"},e=l(`<h1 id="nginx" tabindex="-1">Nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;Nginx&quot;">​</a></h1><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">docker run --name nginx -v /etc/nginx/nginx.conf D:/docker_container_data/nginx -p 80:80 -d nginx:1.22.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>--name</code> 指定运行的容器名为nginx</li><li><code>-v</code> 挂载 nginx.conf 配置文件到宿主机方便配置</li><li><code>-p</code> 指定端口映射</li><li><code>-d</code> 后台运行</li></ul><h2 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h2><table><thead><tr><th>配置块</th><th>功能描述</th></tr></thead><tbody><tr><td>全局块</td><td>与 nginx 运行相关的全局配置</td></tr><tr><td>events 块</td><td>与网络连接有关的设置</td></tr><tr><td>http 块</td><td>代理、缓存、日志、虚拟主机等的配置</td></tr><tr><td>server 块</td><td>虚拟主机的参数设置（一个 http 块可包含多个 server 块）</td></tr><tr><td>location 块</td><td>定义请求路由及页面处理方式</td></tr></tbody></table><h3 id="配置文件示例" tabindex="-1">配置文件示例 <a class="header-anchor" href="#配置文件示例" aria-label="Permalink to &quot;配置文件示例&quot;">​</a></h3><details class="details custom-block"><summary>点击展开示例</summary><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 全局段配置</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 指定运行nginx的用户或用户组，默认为nobody。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#user administrator administrators;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置工作进程数，通常设置为等于CPU核心数。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#worker_processes 2;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 指定nginx进程的PID文件存放位置。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#pid /nginx/pid/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 指定错误日志的存放路径和日志级别。</span></span>
<span class="line"><span style="color:#89DDFF;">error_log </span><span style="color:#BABED8;">log/error.log</span><span style="color:#89DDFF;"> debug;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># events段配置信息</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ------------------------------</span></span>
<span class="line"><span style="color:#C792EA;">events</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 设置网络连接序列化，用于防止多个进程同时接受到新连接的情况，这种情况称为&quot;惊群&quot;。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> accept_mutex </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 设置一个进程是否可以同时接受多个新连接。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> multi_accept </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 设置工作进程的最大连接数。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> worker_connections </span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># http配置段，用于配置HTTP服务器的参数。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ------------------------------</span></span>
<span class="line"><span style="color:#C792EA;">http</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 包含文件扩展名与MIME类型的映射。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#BABED8;">      mime.types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 设置默认的MIME类型。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#BABED8;"> application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 定义日志格式。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> log_format </span><span style="color:#BABED8;">myFormat </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_addr</span><span style="color:#C3E88D;">–</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">time_local</span><span style="color:#C3E88D;">] </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">request</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">body_bytes_sent</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_referer</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_user_agent</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_x_forwarded_for</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 指定访问日志的存放路径和使用的格式。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> access_log </span><span style="color:#BABED8;">log/access.log myFormat</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 允许使用sendfile方式传输文件。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> sendfile </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 限制每次调用sendfile传输的数据量。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> sendfile_max_chunk </span><span style="color:#BABED8;">100k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 设置连接的保持时间。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#BABED8;">65</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 定义一个上游服务器组。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">mysvr </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">server</span><span style="color:#BABED8;"> 127.0.0.1:7878;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">server</span><span style="color:#BABED8;"> 192.168.10.121:3333 backup;  </span><span style="color:#676E95;font-style:italic;">#此服务器为备份服务器。</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 定义错误页面的重定向地址。</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> error_page </span><span style="color:#BABED8;">404 https://www.baidu.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 定义一个虚拟主机。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 设置单个连接上的最大请求次数。</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> keepalive_requests </span><span style="color:#BABED8;">120</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 设置监听的端口和地址。</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">4545</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">127.0.0.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 定义location块，用于匹配特定的请求URI。</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#C792EA;">location</span><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">~*^.+$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#676E95;font-style:italic;"># 设置请求的根目录。</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#676E95;font-style:italic;">#root path;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#676E95;font-style:italic;"># 设置默认页面。</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#676E95;font-style:italic;">#index vv.txt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#676E95;font-style:italic;"># 将请求转发到上游服务器组。</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#BABED8;"> http://mysvr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#676E95;font-style:italic;"># 定义访问控制规则。</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#89DDFF;"> deny </span><span style="color:#BABED8;">127.0.0.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#89DDFF;"> allow </span><span style="color:#BABED8;">172.18.5.54</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        }</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div></details><h2 id="location-路径映射详解" tabindex="-1">location 路径映射详解 <a class="header-anchor" href="#location-路径映射详解" aria-label="Permalink to &quot;location 路径映射详解&quot;">​</a></h2><h3 id="格式" tabindex="-1">格式: <a class="header-anchor" href="#格式" aria-label="Permalink to &quot;格式:&quot;">​</a></h3><div class="language-txt line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">location [ = | ~ | ~* | !~ | !~* | ^~ | @ ] uri {...}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="解释" tabindex="-1">解释: <a class="header-anchor" href="#解释" aria-label="Permalink to &quot;解释:&quot;">​</a></h3><ul><li><code>=</code>：精确匹配。如果匹配成功，立即停止搜索并处理此请求。</li><li><code>~</code>：执行正则匹配，区分大小写。</li><li><code>~*</code>：执行正则匹配，不区分大小写。</li><li><code>!~</code>：正则匹配，区分大小写不匹配。</li><li><code>!~*</code>：正则匹配，不区分大小写不匹配。</li><li><code>^~</code>：前缀匹配。如果匹配成功，不再匹配其他 location，且不查询正则表达式。</li><li><code>@</code>：指定命名的 location，主要用于内部重定向请求，如 error_page 和 try_files。</li><li><code>uri</code>：待匹配的请求字符串。可以是普通字符串或包含正则表达式。</li></ul><h2 id="优先级及示例" tabindex="-1">优先级及示例 <a class="header-anchor" href="#优先级及示例" aria-label="Permalink to &quot;优先级及示例&quot;">​</a></h2><p>优先级顺序：无特定标识 &lt; ^~ &lt; = &lt; 正则匹配 (~, ~<em>, !~, !~</em>)</p><h3 id="示例" tabindex="-1">示例： <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例：&quot;">​</a></h3><details class="details custom-block"><summary>点击展开示例</summary><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 精确匹配 /，主机名后面不能带任何字符串</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/index [匹配失败]</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">^~</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/img/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 以 /img/ 开头的请求，都会匹配上</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/img/a.jpg [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/img/b.mp4 [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">~*</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/Example/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 忽略 uri 部分的大小写</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/test/Example/ [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/example/ [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">/documents </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 如果有正则表达式可以匹配，则优先匹配正则表达式</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/documentsabc [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># http://abc.com/abc [匹配成功]</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 精确匹配 / ，并停止搜索其他 location。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">&quot;hello, nginx1&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 匹配任何以 / 开头的地址，并停止搜索其他 location。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">&quot;hello, nginx2&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">^~</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/images/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 匹配任何以 /images/ 开头的地址，并停止搜索其他 location。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">&quot;hello, nginx3&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">~*</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\\.(gif|jpg|jpeg)$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 匹配任何以 gif、jpg 或 jpeg 结尾的地址，并停止搜索其他 location。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">&quot;hello, nginx4&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">/images/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 匹配任何以 /images/ 开头的地址，并停止搜索其他 location。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">&quot;hello, nginx5&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/images/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 精确匹配 /images/，并停止搜索其他 location。</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">&quot;hello, nginx6&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div></details><h2 id="反向代理" tabindex="-1">反向代理 <a class="header-anchor" href="#反向代理" aria-label="Permalink to &quot;反向代理&quot;">​</a></h2><p>反向代理是 Nginx 的核心功能之一，允许 Nginx 将来自客户端的请求转发到后端服务器，并将后端服务器的响应返回给客户端，使客户端感觉就像是直接与 Nginx 通信一样。</p><h3 id="基本配置" tabindex="-1">基本配置 <a class="header-anchor" href="#基本配置" aria-label="Permalink to &quot;基本配置&quot;">​</a></h3><p>要配置 Nginx 作为反向代理，您需要使用 location 块中的 proxy_pass 指令：</p><ul><li><code>proxy_pass</code>：定义后端服务器的地址。</li><li><code>proxy_set_header</code>：修改从客户端传递到代理服务器的请求头。</li><li><code>proxy_hide_header</code>：隐藏从代理服务器返回的响应头。</li><li><code>proxy_redirect</code>：修改从代理服务器返回的响应头中的 Location 和 Refresh 头字段。</li></ul><h3 id="示例配置" tabindex="-1">示例配置 <a class="header-anchor" href="#示例配置" aria-label="Permalink to &quot;示例配置&quot;">​</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#BABED8;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#BABED8;">example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">location</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#BABED8;">http://localhost:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#BABED8;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#BABED8;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#BABED8;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在此配置中，所有发送到 example.com 的请求都会被代理到 localhost:8080。</p><h3 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><ul><li>当使用 <code>proxy_pass</code> 指令时，确保后端服务器是可用的，否则 Nginx 将返回错误。</li><li>使用 <code>proxy_set_header</code> 确保后端服务器接收到正确的请求头。</li><li>如果后端服务器和 Nginx 在不同的机器上，确保网络连接是稳定的。</li></ul><p>反向代理不仅可以提高网站的性能和可靠性，还可以用于负载均衡、缓存静态内容、维护和安全等多种用途。</p><p>......</p><p><a href="https://juejin.cn/post/7267003603095879714#heading-3" target="_blank" rel="noreferrer">https://juejin.cn/post/7267003603095879714#heading-3</a></p>`,30),o=[e];function c(r,t,i,y,B,b){return n(),a("div",null,o)}const u=s(p,[["render",c]]);export{E as __pageData,u as default};
